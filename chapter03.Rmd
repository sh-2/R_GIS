```{r, message=FALSE, echo=FALSE}
library(tmap)
library(mapview)
library(sf)
library(stars)
tmap_mode("view")
```



# GISの全体像

GIS分析に使うデータは主に2つの形式があります。**ベクターデータ**と**ラスターデータ**です。また、これらのデータの位置情報を定義する**座標系（CRS）**も知っておかなければいけません。まずはベクターデータの説明からしていきます。

## ベクターデータ
ベクターデータとは言っていますが、高校数学に出てくるベクトルとほぼ同じことを言っています。要するに地物を表すために、位置情報(GPSなど)を持ったデータ（線や点）のことを意味しています。  
ベクターデータには代表的なデータが3種類あります。

<br />


**1.ポイント**  
下の図は23区近郊の郵便局の位置を示したデータです。  
ポイントは大きさを持っておらず、ただ位置を表しているだけです。（図に示すために見た目上は大きさがあります。）
```{r echo=FALSE, message=FALSE, include=FALSE}
demo01 <- st_read("tokyo/post_office_9kei.shp")
```

```{r echo=FALSE}
tm_shape(demo01) +
  tm_symbols(size = 0.01) 
```

<br />

**2.ライン**  
下の図は東京近郊の川を示したデータです。  
ラインは長さを持ったデータです。（ポイントの集まり・ポイントを結んだものとも言えます。）線路や道路等もこの形式で表されます。
```{r echo=FALSE, message=FALSE, include=FALSE}
demo02 <- st_read("tokyo/river_9kei.shp") 
```

```{r echo=FALSE}
tm_shape(demo02) + 
  tm_lines() 
```

<br />

**3.ポリゴン**  
下の図は23区の境界を示したデータです。  
ポリゴンはラインによって囲まれた範囲のこと言います。ポリゴンは主に行政区を表すために使われます。
```{r echo=FALSE, message=FALSE, include=FALSE}
demo03 <- st_read("tokyo/tokyo_23ku_jgd2011_9.shp")
```

```{r echo=FALSE}
tm_shape(demo03) + 
  tm_polygons() 
```

以上がベクターデータの3例です。ちなみにこれらの規格をSimple Featuresといいます。  
<br />
ベクターデータは拡大・縮小したとしても大きさやデータに変化はありません。（どれだけ近づいて見ても離れて見ても、郵便局の位置は変わりませんし、行政区の区切りも変わりません。）次に紹介するラスターデータは拡大縮小の影響を受けます。

<br />

## ラスターデータ

ラスターデータとは位置情報と、ピクセル毎に値を持ったデータのことを言います。上空から撮影された写真をピクセル毎に値（e.g.標高が高いほど濃い色を塗る）を付けたような形式です。  
こちらのサイト**[「GIS実習オープン教材」](https://gis-oer.github.io/gitbook/book/materials/00/00.html#%E3%83%A9%E3%82%B9%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF)**のサイトの方が分かりやすいかと思いますので、参考にしてください。
<br />

以下に2つの例を示します。

<br />


**例1, 標高データ**  
標高の高いところほど、緑っぽく表示されています。
```{r message=FALSE, echo=FALSE}
read_stars("tokyo/tokyo_srtm.tif") %>%
  tm_shape() +
  tm_raster()
```

<br />
**例2, 夜間光データ**  
分かりにくいですが、東京都心部の色が濃くなっています。
```{r echo=FALSE, message=FALSE}
read_stars("DMSP_nightlight_tokyo.tif") %>%
  mapview()
```
<br />
拡大してみると分かると思いますが、同一のピクセル内では同じ値(色)になってしまいます。  
ベクターデータは拡大縮小の影響を受けないと説明しましたが、ラスターデータはその影響を受けます。ラスターデータはピクセル毎に値を付与する関係上「ピクセルの細かさ＝ラスターデータの解像度」となってしまいます。  
例えば1km^2^ごとに分析をしたいときに、ラスターデータのピクセルが2km^2^の精度で値が付与されている場合、隣り合うマス目が同じ値になる、という事態が発生してしまいます。なのでラスターデータの解像度に対して、分析範囲が狭い場合には注意が必要です。

## 座標系(CRS)
座標系(CRS:Coordinate Reference System)はベクター・ラスターデータをどのように投影するのかを定義するものです。  
地球は球体とされていますが、そもそも完全な球体ではなかったり、そんな地球上の位置情報を2次元で扱いたいということで、位置情報の定義の仕方が多くあります。なので分析を行う際には1つの座標系に統一する必要があります。(方法は後述します。)  
実際に分析を行う際にはUTMという座標系を使うことをお勧めします。多少の歪みはありますがUTM座標系では、メートル等の長さの尺度を2次元で扱うことができるためです。  
<br />
座標系は**[「epsg.io」](https://epsg.io/)**から検索できます。例えば日本の座標系であれば、「Japan UTM」と検索すれば調べることができます。検索してみると「WGS 84 / UTM zone 54N」がみつかると思うので、「EPSG:32654」というコードをメモっておきます。この**32654**のコードを用いて今後、座標系を定めていきます。

